<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>ãƒ©ãƒ¼ãƒ¡ãƒ³åº— é–‰åº—æ¥­å‹™ç®¡ç†</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 15px; background-color: #f8f9fa; color: #333; max-width: 600px; margin: 0 auto; }
        
        /* ãƒˆãƒƒãƒ—ç”»é¢ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
        h1 { text-align: center; color: #e44d26; font-size: 1.3rem; margin-bottom: 20px; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 30px; }
        .status-card { background: white; padding: 10px 5px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 2px solid #eee; }
        .status-card.done { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .role-icon { font-size: 1.5rem; display: block; margin-bottom: 5px; }
        .role-name { font-size: 0.8rem; font-weight: bold; display: block; }
        .worker-name { font-size: 0.7rem; color: #666; margin-top: 4px; display: block; height: 1em; }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆæœ€åˆã¯éš ã™ï¼‰ */
        #login-area, #checklist-area { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        /* åå‰å…¥åŠ› */
        label { font-weight: bold; display: block; margin-bottom: 8px; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-bottom: 20px; }

        /* å½¹å‰²é¸æŠãƒœã‚¿ãƒ³ */
        .role-btn-group { display: grid; gap: 10px; }
        .role-select-btn { padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: white; font-size: 1rem; font-weight: bold; cursor: pointer; text-align: left; display: flex; align-items: center; transition: 0.2s; }
        .role-select-btn:hover { background: #f0f0f0; }
        .role-select-btn span { margin-right: 10px; font-size: 1.2rem; }

        /* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ */
        .check-item { padding: 12px 0; border-bottom: 1px dashed #eee; display: flex; align-items: center; cursor: pointer; }
        .check-item:last-child { border-bottom: none; }
        input[type="checkbox"] { transform: scale(1.6); margin-right: 15px; cursor: pointer; }
        
        /* é€ä¿¡ãƒœã‚¿ãƒ³ */
        .submit-btn { width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .back-btn { background: #6c757d; margin-top: 10px; }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading { text-align: center; color: #666; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>ğŸœ é–‰åº—æ¥­å‹™çŠ¶æ³</h1>
    <div id="loading-msg" class="loading">çŠ¶æ³ã‚’ç¢ºèªä¸­...</div>
    <div class="dashboard">
        <div class="status-card" id="card-kitchen">
            <span class="role-icon">ğŸ”¥</span>
            <span class="role-name">1ç•ªæ‰‹</span>
            <span class="worker-name" id="user-kitchen">-</span>
        </div>
        <div class="status-card" id="card-hall">
            <span class="role-icon">ğŸ–ï¸</span>
            <span class="role-name">ãƒ›ãƒ¼ãƒ«</span>
            <span class="worker-name" id="user-hall">-</span>
        </div>
        <div class="status-card" id="card-wash">
            <span class="role-icon">ğŸ§¼</span>
            <span class="role-name">æ´—ã„å ´</span>
            <span class="worker-name" id="user-wash">-</span>
        </div>
    </div>

    <div id="login-area">
        <label>ã‚ãªãŸã®åå‰</label>
        <input type="text" id="my-name" placeholder="ä¾‹ï¼šæ‘ä¸Š" onchange="saveName()">
        
        <label>æ‹…å½“ã™ã‚‹å½¹å‰²ã‚’é¸ã‚“ã§é–‹å§‹</label>
        <div class="role-btn-group">
            <button class="role-select-btn" onclick="startCheck('kitchen')">
                <span>ğŸ”¥</span> 1ç•ªæ‰‹ï¼ˆå¨æˆ¿ï¼‰
            </button>
            <button class="role-select-btn" onclick="startCheck('hall')">
                <span>ğŸ–ï¸</span> ãƒ›ãƒ¼ãƒ«
            </button>
            <button class="role-select-btn" onclick="startCheck('wash')">
                <span>ğŸ§¼</span> æ´—ã„å ´
            </button>
        </div>
    </div>

    <div id="checklist-area" style="display: none;">
        <h2 id="checklist-title" style="margin-top:0; border-bottom:2px solid #eee; padding-bottom:10px;"></h2>
        <div id="checklist-items"></div>
        
        <button class="submit-btn" onclick="submitData()">âœ… å®Œäº†å ±å‘Šã™ã‚‹</button>
        <button class="submit-btn back-btn" onclick="showLogin()">æˆ»ã‚‹</button>
    </div>

    <script>
        // â˜…ã“ã“ã«GASã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz60F58Y1onUzPtDiUX5ytXfDnSQ0EQ8sOFa9L4RRwvJ4bfSlzsx0_iR984zJZ37mxy/exec";

        // å½¹å‰²ã”ã¨ã®é …ç›®å®šç¾©
        const roles = {
            kitchen: {
                name: "1ç•ªæ‰‹",
                items: ["ã‚¬ã‚¹ã®å…ƒæ “é–‰ã¾ã£ã¦ã‚‹ã‹", "ã‚³ãƒ¼ãƒ«ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ç¶ºéº—ã‹", "ã‚¹ãƒ¼ãƒ—ã€å‰ç„¼ã€é‡èœã—ã¾ã£ãŸã‹", "è£œå……ç³»çµ‚ã‚ã£ã¦ã„ã‚‹ã‹", "æ°´é“é–‰ã¾ã£ã¦ã„ã‚‹ã‹", "éºµæ®‹é‡æ›¸ã„ãŸã‹"]
            },
            hall: {
                name: "ãƒ›ãƒ¼ãƒ«",
                items: ["ç®¸é†¤æ²¹ã€ãƒãƒ¨è£œå……ã—ãŸã‹", "ç”Ÿå§œé–‰ã¾ã£ãŸã‹", "ãƒ›ãƒ¼ãƒ«åºŠã‚´ãƒŸè½ã¡ã¦ãªã„ã‹", "åˆ¸å£²æ©Ÿã€å£²ä¸Šé€Ÿå ±ã€éµé–‰ã‚", "èƒŒè„‚ä¿æ¸©ã‚¹ã‚¤ãƒƒãƒå…¥ã£ã¦ã„ã‚‹ã‹", "åµè£œå……ã€ãŠã¾ã‘ã‚¿ãƒƒãƒ‘ãƒ¼è£œå……", "ã‚´ãƒŸç‰‡ä»˜ã‘ã€ãƒˆã‚¤ãƒ¬é›»æ°—", "ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨æ‹­ã"]
            },
            wash: {
                name: "æ´—ã„å ´",
                items: ["ãƒãƒ³ãƒ‰ã‚½ãƒ¼ãƒ—ã€æ´—å‰¤è£œå……", "æ´—ã„å ´ã‚´ãƒŸè½ã¡ã¦ãªã„ã‹"]
            }
        };

        let currentRole = "";

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.onload = function() {
            loadStatus(); // å…¨å“¡ã®çŠ¶æ³ã‚’å–å¾—
            // åå‰ã‚’è¦šãˆã¦ã„ãŸã‚‰è‡ªå‹•å…¥åŠ›
            const savedName = localStorage.getItem('ramen_worker_name');
            if (savedName) document.getElementById('my-name').value = savedName;
        };

        // åå‰ã‚’ã‚¹ãƒãƒ›ã«ä¿å­˜ã™ã‚‹ï¼ˆæ‰‹æ•°ã‚’æ¸›ã‚‰ã™ï¼‰
        function saveName() {
            const name = document.getElementById('my-name').value;
            localStorage.setItem('ramen_worker_name', name);
        }

        // ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã™ã‚‹
        function startCheck(roleKey) {
            const name = document.getElementById('my-name').value;
            if (!name) return alert("å…ˆã«åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            saveName(); // å¿µã®ãŸã‚ä¿å­˜

            currentRole = roleKey;
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('login-area').style.display = 'none';
            document.getElementById('checklist-area').style.display = 'block';
            
            // é …ç›®ã®ç”Ÿæˆ
            const data = roles[roleKey];
            document.getElementById('checklist-title').innerText = data.name + " ãƒã‚§ãƒƒã‚¯";
            const container = document.getElementById('checklist-items');
            container.innerHTML = "";
            
            data.items.forEach((item, index) => {
                container.innerHTML += `
                    <label class="check-item">
                        <input type="checkbox" id="chk-${index}">
                        ${item}
                    </label>
                `;
            });
            
            // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            window.scrollTo(0, 0);
        }

        function showLogin() {
            document.getElementById('checklist-area').style.display = 'none';
            document.getElementById('login-area').style.display = 'block';
        }

        // çŠ¶æ³ã‚’å–å¾—ã—ã¦è¡¨ç¤ºï¼ˆå¯è¦–åŒ–ï¼‰
        async function loadStatus() {
            if (GAS_URL.includes("â˜…")) return;
            try {
                const res = await fetch(GAS_URL);
                const data = await res.json();
                
                // ä»Šæ—¥ã®æ—¥ä»˜æ–‡å­—åˆ—
                const today = new Date();
                const todayStr = `${today.getFullYear()}/${String(today.getMonth()+1).padStart(2,'0')}/${String(today.getDate()).padStart(2,'0')}`;

                document.getElementById('loading-msg').style.display = 'none';

                // æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åæ˜ 
                data.forEach(row => {
                    // GASã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿: [æ—¥ä»˜, åå‰, å½¹å‰²(æ—¥æœ¬èª), çŠ¶æ³]
                    const date = row[0];
                    const user = row[1];
                    const roleName = row[2];
                    const status = row[3];

                    // æ—¥ä»˜ãŒä¸€è‡´ã™ã‚‹å ´åˆã®ã¿è¡¨ç¤º
                    if (date === todayStr && status.includes("å®Œäº†")) {
                        // å½¹å‰²åã‹ã‚‰IDã‚’ç‰¹å®š
                        let key = "";
                        if (roleName === roles.kitchen.name) key = "kitchen";
                        if (roleName === roles.hall.name) key = "hall";
                        if (roleName === roles.wash.name) key = "wash";

                        if (key) {
                            const card = document.getElementById(`card-${key}`);
                            card.classList.add('done');
                            document.getElementById(`user-${key}`).innerText = "æ¸ˆ: " + user;
                        }
                    }
                });
            } catch(e) {
                console.error(e);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        async function submitData() {
            const name = document.getElementById('my-name').value;
            const checkboxes = document.querySelectorAll('#checklist-items input');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);

            if (!allChecked) return alert("æœªå®Œäº†ã®é …ç›®ãŒã‚ã‚Šã¾ã™ï¼");

            if (!confirm("å®Œäº†å ±å‘Šã‚’é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ")) return;

            const payload = {
                user: name,
                role: roles[currentRole].name,
                status: "âœ… å®Œäº†"
            };

            try {
                await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify(payload)
                });
                alert("ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼");
                location.reload(); // æœ€åˆã«æˆ»ã‚‹
            } catch(e) {
                alert("é€ä¿¡å¤±æ•—");
            }
        }
    </script>
</body>
</html>