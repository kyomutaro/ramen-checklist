<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">
<title>ã¶ã£è±š é–‰åº—æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
<style>
    /* â˜…éŠã³å¿ƒãƒã‚¤ãƒ³ãƒˆ1ï¼šã“ã“ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å¤‰ãˆã‚‹ã¨ã€ã‚¢ãƒ—ãƒªå…¨ä½“ã®è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ */
    :root {
        --color-hall: #ff006a;     /* ãƒ›ãƒ¼ã‚‹ã®è‰²ãƒ”ãƒ³ã‚¯ */
        --color-kitchen: #dcd935;  /* 1ç•ªæ‰‹ã®è‰²ï¼ˆé»„è‰²ï¼‰ */
        --color-wash: #33a4d1;     /* æ´—ã„å ´ã®è‰²ï¼ˆæ°´è‰²ï¼‰ */
        --bg-color: #f4f6f7;       /* èƒŒæ™¯è‰² */
    }

    body { font-family: -apple-system, sans-serif; margin: 0; padding: 15px; background: var(--bg-color); padding-bottom: 80px; }
    
    h1 { text-align: center; color: #333; font-size: 1.2rem; margin-bottom: 5px; }
    .date-display { text-align: center; font-size: 0.8rem; color: #666; margin-bottom: 20px; }

    /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆä¿¡å·æ©Ÿï¼‰ */
    .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
    .status-card { background: white; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid #ddd; opacity: 0.6; }
    
    /* å®Œäº†ã—ãŸæ™‚ã®è¦‹ãŸç›® */
    .status-card.done { opacity: 1; border-color: currentColor; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transform: scale(1.05); transition: 0.3s; }
    
    .role-icon { font-size: 2rem; display: block; }
    .role-label { font-size: 0.8rem; font-weight: bold; display: block; }
    .worker-name { font-size: 0.7rem; color: #555; display: block; margin-top: 5px; min-height: 1em; }

    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«é¢¨ï¼‰ */
    #login-area { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; text-align: center; }
    input[type="text"] { width: 80%; padding: 12px; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 15px; text-align: center; }
    
    .role-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: none; border-radius: 8px; font-weight: bold; color: white; cursor: pointer; font-size: 1rem; transition: 0.2s; }
    .role-btn:active { transform: scale(0.98); }

    /* æœ¬äººç¢ºèªç”»é¢ */
    #confirm-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
    .confirm-box { background: white; padding: 30px; border-radius: 10px; text-align: center; width: 80%; max-width: 300px; }
    .confirm-btns { display: flex; gap: 10px; margin-top: 20px; }
    .confirm-btns button { flex: 1; padding: 10px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }

    /* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ */
    #checklist-area { display: none; background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
    .check-item { padding: 12px 0; border-bottom: 1px dashed #eee; display: flex; align-items: center; }
    input[type="checkbox"] { transform: scale(1.5); margin-right: 15px; }

    .submit-btn { width: 100%; padding: 15px; background: #333; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; margin-top: 20px; cursor: pointer; }
    .back-btn { background: #999; margin-top: 10px; }

    /* å±¥æ­´ã‚¨ãƒªã‚¢ */
    #history-area { display: none; max-width: 600px; margin: 0 auto; }
    .history-item { background: white; padding: 10px; margin-bottom: 8px; border-radius: 8px; font-size: 0.9rem; border-left: 5px solid #ccc; }

    /* ä¸‹éƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .bottom-menu { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; display: flex; height: 60px; }
    .menu-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #999; font-size: 0.7rem; cursor: pointer; }
    .menu-item.active { color: #e44d26; font-weight: bold; }
    .menu-icon { font-size: 1.5rem; margin-bottom: 2px; }

</style>
</head>
<body>

    <h1>ğŸ–ğŸœ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h1>
    <div class="date-display" id="today-display"></div>

    <div class="dashboard">
        <div class="status-card" id="card-kitchen" style="color:var(--color-kitchen)">
            <span class="role-icon">ğŸŒŸ</span>
            <span class="role-label">1ç•ªæ‰‹</span>
            <span class="worker-name" id="name-kitchen">-</span>
        </div>
        <div class="status-card" id="card-hall" style="color:var(--color-hall)">
            <span class="role-icon">ğŸ–ï¸</span>
            <span class="role-label">ãƒ›ãƒ¼ãƒ«</span>
            <span class="worker-name" id="name-hall">-</span>
        </div>
        <div class="status-card" id="card-wash" style="color:var(--color-wash)">
            <span class="role-icon">ğŸ§¼</span>
            <span class="role-label">æ´—ã„å ´</span>
            <span class="worker-name" id="name-wash">-</span>
        </div>
    </div>

    <div id="login-area">
        <p>ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        <input type="text" id="input-name" placeholder="ä¾‹ï¼šæ‘ä¸Š">
        
        <p>æ‹…å½“ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
        <button class="role-btn" style="background:var(--color-kitchen)" onclick="preLogin('kitchen')">ğŸŒŸ 1ç•ªæ‰‹ï¼ˆå¨æˆ¿ï¼‰</button>
        <button class="role-btn" style="background:var(--color-hall)" onclick="preLogin('hall')">ğŸ–ï¸ ãƒ›ãƒ¼ãƒ«</button>
        <button class="role-btn" style="background:var(--color-wash)" onclick="preLogin('wash')">ğŸ§¼ æ´—ã„å ´</button>
    </div>

    <div id="confirm-modal">
        <div class="confirm-box">
            <h3>æœ¬äººç¢ºèª</h3>
            <p>ã‚ãªãŸã¯æœ¬å½“ã«<br><b id="confirm-name-display" style="font-size:1.2rem; color:#e44d26;"></b><br>ã•ã‚“ã§ã™ã‹ï¼Ÿ</p>
            <div class="confirm-btns">
                <button style="background:#ddd;" onclick="closeConfirm()">ã„ã„ãˆ</button>
                <button style="background:#28a745; color:white;" onclick="executeLogin()">ã¯ã„</button>
            </div>
        </div>
    </div>

    <div id="checklist-area">
        <h2 id="checklist-title" style="margin-top:0; border-bottom:1px solid #eee;"></h2>
        <div id="checklist-items"></div>
        <button class="submit-btn" onclick="submitData()">âœ… å®Œäº†å ±å‘Šã—ã¦ä¿å­˜</button>
        <button class="submit-btn back-btn" onclick="logout()">ä¸­æ–­ã—ã¦æˆ»ã‚‹</button>
    </div>

    <div id="history-area">
        <h3 style="text-align:center;">ğŸ“‹ ä»Šæ—¥ã®å±¥æ­´</h3>
        <button onclick="loadHistory()" style="width:100%; padding:10px; margin-bottom:10px;">å†èª­ã¿è¾¼ã¿</button>
        <div id="history-list"></div>
    </div>

    <div class="bottom-menu">
        <div class="menu-item active" onclick="showTab('main')">
            <span class="menu-icon">ğŸ“</span>ãƒã‚§ãƒƒã‚¯
        </div>
        <div class="menu-item" onclick="showTab('history')">
            <span class="menu-icon">ğŸ“…</span>å±¥æ­´
        </div>
    </div>

<script>
    // â˜…ã“ã“ã«æ–°ã—ã„GASã®URLã‚’å…¥ã‚Œã‚‹â˜…
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxPST3OG-wLqFzKoUO4FUi93kMUAHoAJxhVx9VQDtIz0NpCihjRY_8SCoqjqkRg5EI-/exec";

    // ãƒ‡ãƒ¼ã‚¿å®šç¾©
    const ROLES = {
        kitchen: { name: "1ç•ªæ‰‹", items: ["ã‚¬ã‚¹ã®å…ƒæ “é–‰", "ã‚³ãƒ¼ãƒ«ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«", "ã‚¹ãƒ¼ãƒ—ãƒ»è‚‰ãƒ»é‡èœåç´", "è£œå……ç³»å®Œäº†", "æ°´é“é–‰", "éººæ®‹é‡è¨˜å…¥"] },
        hall: { name: "ãƒ›ãƒ¼ãƒ«", items: ["ç®¸é†¤æ²¹ã€ãƒãƒ¨è£œå……", "ç”Ÿå§œé–‰ã¾ã£ãŸã‹", "åºŠã‚´ãƒŸç¢ºèª", "åˆ¸å£²æ©Ÿãƒ»éµé–‰ã‚", "èƒŒè„‚SWã‚ªãƒ•", "åµè£œå……", "ã‚´ãƒŸãƒ»ãƒˆã‚¤ãƒ¬é›»æ°—", "ãƒ†ãƒ¼ãƒ–ãƒ«å…¨æ‹­ã", "ã‚³ãƒƒãƒ—ã®ç‰‡ã¥ã‘"] },
        wash: { name: "æ´—ã„å ´", items: ["æ´—å‰¤ãƒ»ãƒãƒ³ãƒ‰ã‚½ãƒ¼ãƒ—è£œå……", "ã‚´ãƒŸæ¨ã¦å®Œäº†", "ã‚·ãƒ³ã‚¯å†…æ¸…æƒ", "æ´—ã„å ´ã‚´ãƒŸç¢ºèª"] }
    };

    let tempRole = ""; // ãƒ­ã‚°ã‚¤ãƒ³å‰ã®ä»®ç½®ã
    let currentRole = "";
    let currentName = "";

    // ------------------------------------------
    // 1. èµ·å‹•æ™‚ã®å‡¦ç†ï¼ˆç¿Œæœã‚¯ãƒªã‚¢æ©Ÿèƒ½ï¼‰
    // ------------------------------------------
    window.onload = function() {
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¡¨ç¤º
        const todayStr = new Date().toLocaleDateString('ja-JP');
        document.getElementById('today-display').innerText = todayStr;

        // ã€ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆã€‘ä¿å­˜ã•ã‚ŒãŸæ—¥ä»˜ã¨ä»Šæ—¥ãŒé•ã†ãªã‚‰ã€ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™
        const savedDate = localStorage.getItem('ramen_date');
        if (savedDate !== todayStr) {
            localStorage.removeItem('ramen_checks'); // ãƒã‚§ãƒƒã‚¯çŠ¶æ³ã‚’æ¶ˆã™
            localStorage.setItem('ramen_date', todayStr); // ä»Šæ—¥ã‚’ã‚»ãƒƒãƒˆ
        }

        // åå‰ã‚’å¾©å…ƒ
        const savedName = localStorage.getItem('ramen_name');
        if(savedName) document.getElementById('input-name').value = savedName;

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        loadHistory();
    };

    // ------------------------------------------
    // 2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆæœ¬äººç¢ºèªã‚ã‚Šï¼‰
    // ------------------------------------------
    function preLogin(roleKey) {
        const name = document.getElementById('input-name').value;
        if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        
        // ä»®ä¿å­˜ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‡ºã™
        tempRole = roleKey;
        document.getElementById('confirm-name-display').innerText = name;
        document.getElementById('confirm-modal').style.display = 'flex';
    }

    function closeConfirm() {
        document.getElementById('confirm-modal').style.display = 'none';
    }

    function executeLogin() {
        // ã€Œã¯ã„ã€ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ­ã‚°ã‚¤ãƒ³ç¢ºå®š
        currentName = document.getElementById('input-name').value;
        currentRole = tempRole;
        
        // åå‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆæ¬¡å›ã®æ‰‹é–“ã‚’çœãï¼‰
        localStorage.setItem('ramen_name', currentName);

        closeConfirm();
        document.getElementById('login-area').style.display = 'none';
        document.getElementById('checklist-area').style.display = 'block';

        renderChecklist();
    }

    function logout() {
        document.getElementById('checklist-area').style.display = 'none';
        document.getElementById('login-area').style.display = 'block';
    }

    // ------------------------------------------
    // 3. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå‡¦ç†
    // ------------------------------------------
    function renderChecklist() {
        const container = document.getElementById('checklist-items');
        const roleData = ROLES[currentRole];
        document.getElementById('checklist-title').innerText = roleData.name + " ãƒã‚§ãƒƒã‚¯";
        
        container.innerHTML = "";

        // ä¿å­˜ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯çŠ¶æ³ã‚’å¾©å…ƒ
        let savedChecks = JSON.parse(localStorage.getItem('ramen_checks') || "{}");
        // ã‚­ãƒ¼ä¾‹: "kitchen-0", "hall-2"

        roleData.items.forEach((item, idx) => {
            const checkKey = `${currentRole}-${idx}`;
            const isChecked = savedChecks[checkKey] ? "checked" : "";
            
            container.innerHTML += `
                <label class="check-item">
                    <input type="checkbox" id="${checkKey}" ${isChecked} onchange="saveCheck('${checkKey}', this.checked)">
                    <span>${item}</span>
                </label>
            `;
        });
    }

    // ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã³ã«ã‚¹ãƒãƒ›ã«ä¿å­˜ï¼ˆèª¤ã£ã¦é–‰ã˜ã¦ã‚‚OKï¼‰
    function saveCheck(key, checked) {
        let savedChecks = JSON.parse(localStorage.getItem('ramen_checks') || "{}");
        if (checked) {
            savedChecks[key] = true;
        } else {
            delete savedChecks[key];
        }
        localStorage.setItem('ramen_checks', JSON.stringify(savedChecks));
    }

    // ------------------------------------------
    // 4. é€ä¿¡å‡¦ç†ï¼ˆBæ¡ˆï¼šè‡ªåˆ†ã®åˆ†ã ã‘ä¿å­˜ï¼‰
    // ------------------------------------------
    async function submitData() {
        // å…¨ãƒã‚§ãƒƒã‚¯ç¢ºèª
        const inputs = document.querySelectorAll('#checklist-items input');
        const allChecked = Array.from(inputs).every(input => input.checked);

        if (!allChecked) return alert("ã¾ã ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„é …ç›®ãŒã‚ã‚Šã¾ã™ï¼");

        if (!confirm("å®Œäº†ã¨ã—ã¦å ±å‘Šã—ã¾ã™ã‹ï¼Ÿ")) return;

        const btn = document.querySelector('.submit-btn');
        btn.disabled = true;
        btn.innerText = "é€ä¿¡ä¸­...";

        try {
            const payload = {
                roleName: ROLES[currentRole].name, // æ—¥æœ¬èªã®å½¹å‰²å
                user: currentName,
                status: "å®Œäº†"
            };

            await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify(payload)
            });

            alert("ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼è¨˜éŒ²ã—ã¾ã—ãŸã€‚");
            
            // é€ä¿¡å®Œäº†ã—ãŸã‚‰ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
            logout();
            loadHistory(); // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°

        } catch(e) {
            alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼ã€‚é›»æ³¢ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        } finally {
            btn.disabled = false;
            btn.innerText = "âœ… å®Œäº†å ±å‘Šã—ã¦ä¿å­˜";
        }
    }

    // ------------------------------------------
    // 5. å±¥æ­´ï¼†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
    // ------------------------------------------
    async function loadHistory() {
        if (GAS_URL.includes("â˜…")) return;

        try {
            const res = await fetch(GAS_URL);
            const data = await res.json(); // [[æ—¥ä»˜, å½¹å‰², åå‰, çŠ¶æ³], ...]
            
            const todayStr = new Date().toLocaleDateString('ja-JP', {year:'numeric', month:'2-digit', day:'2-digit'}).replace(/\//g, '/');
            // GASã®æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«åˆã‚ã›ã‚‹ï¼ˆyyyy/MM/ddï¼‰
            
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = "";

            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒªã‚»ãƒƒãƒˆ
            ['kitchen', 'hall', 'wash'].forEach(role => {
                const card = document.getElementById(`card-${role}`);
                card.classList.remove('done');
                document.getElementById(`name-${role}`).innerText = "-";
            });

            // ãƒ‡ãƒ¼ã‚¿ã®èµ°æŸ»
            data.forEach(row => {
                const date = row[0];
                const roleName = row[1];
                const name = row[2];
                
                // ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ãªã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«åæ˜ 
                if (date === todayStr) {
                    let key = "";
                    if (roleName === "1ç•ªæ‰‹") key = "kitchen";
                    if (roleName === "ãƒ›ãƒ¼ãƒ«") key = "hall";
                    if (roleName === "æ´—ã„å ´") key = "wash";

                    if (key) {
                        const card = document.getElementById(`card-${key}`);
                        card.classList.add('done');
                        document.getElementById(`name-${key}`).innerText = "æ¸ˆ: " + name;
                    }
                }

                // å±¥æ­´ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆä»Šæ—¥ä»¥å¤–ã®ã‚‚ã®ã‚‚è¦‹ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãªã‚‰ifã‚’å¤–ã™ï¼‰
                if (date === todayStr) {
                    let color = "#333";
                    if (roleName === "1ç•ªæ‰‹") color = "var(--color-kitchen)";
                    if (roleName === "ãƒ›ãƒ¼ãƒ«") color = "var(--color-hall)";
                    if (roleName === "æ´—ã„å ´") color = "var(--color-wash)";

                    historyList.innerHTML += `
                        <div class="history-item" style="border-left-color:${color}">
                            <b>${roleName}</b> - ${name} <span style="float:right; color:green">å®Œäº†</span>
                            <div style="font-size:0.7rem; color:#999">${date}</div>
                        </div>
                    `;
                }
            });

        } catch(e) {
            console.error(e);
        }
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function showTab(tabName) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        
        if (tabName === 'main') {
            document.querySelector('.menu-item:nth-child(1)').classList.add('active');
            document.getElementById('history-area').style.display = 'none';
            // ãƒ­ã‚°ã‚¤ãƒ³ä¸­ãªã‚‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€ãã†ã§ãªã‘ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
            if (document.getElementById('checklist-area').style.display === 'block') {
                 // ãã®ã¾ã¾
            } else {
                document.getElementById('login-area').style.display = 'block';
            }
        } else {
            document.querySelector('.menu-item:nth-child(2)').classList.add('active');
            document.getElementById('login-area').style.display = 'none';
            document.getElementById('checklist-area').style.display = 'none';
            document.getElementById('history-area').style.display = 'block';
            loadHistory();
        }
    }
</script>
</body>
</html>