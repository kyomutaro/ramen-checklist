<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>ãƒ©ãƒ¼ãƒ¡ãƒ³åº— é€€å‡ºãƒã‚§ãƒƒã‚¯ç®¡ç†</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 15px; background-color: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h1 { color: #e44d26; font-size: 1.5rem; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        h2 { font-size: 1.1rem; color: #555; margin-top: 20px; background: #eee; padding: 5px 10px; border-radius: 5px; }
        .item { display: flex; align-items: center; margin: 15px 0; font-size: 1.0rem; cursor: pointer; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
        input[type="checkbox"] { transform: scale(1.5); margin-right: 15px; }
        .input-group { margin: 20px 0; }
        input[type="text"] { width: 100%; padding: 12px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
        button { width: 100%; background: #28a745; color: white; border: none; padding: 15px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; margin-top: 15px; cursor: pointer; }
        button:active { background: #218838; }
        .view-btn { background: #007bff; margin-top: 10px; font-size: 1rem; }
        #history { margin-top: 20px; font-size: 0.9rem; border-top: 1px solid #eee; padding-top: 10px; line-height: 1.6; }
        .history-item { border-bottom: 1px solid #eee; padding: 8px 0; }
        .error-msg { color: red; font-weight: bold; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card" id="mainCard" style="display:none;">
        <h1>ğŸœ é€€å‡ºãƒã‚§ãƒƒã‚¯ç®¡ç†</h1>
        
        <div class="input-group">
            <label>æ‹…å½“è€…åï¼š</label>
            <input type="text" id="userName" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        </div>

        <div id="checklist"></div>

        <button onclick="submitData()">âœ… é€ä¿¡ã—ã¦è¨˜éŒ²ã™ã‚‹</button>
        <button class="view-btn" onclick="fetchHistory()">ğŸ“‹ éå»ã®å±¥æ­´ã‚’è¡¨ç¤º</button>
        
        <div id="history"></div>
    </div>

    <script>
        // ==========================================
        //  è¨­å®šã‚¨ãƒªã‚¢
        // ==========================================
        
        // â˜…ã“ã“ã«GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¶ˆã•ãªã„ã“ã¨ï¼ï¼‰
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz60F58Y1onUzPtDiUX5ytXfDnSQ0EQ8sOFa9L4RRwvJ4bfSlzsx0_iR984zJZ37mxy/exec";

        // â˜…åˆè¨€è‘‰ã®è¨­å®šï¼ˆã“ã“ã‚’å¤‰ãˆã‚‹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¤‰ã‚ã‚Šã¾ã™ï¼‰
        const SECRET_PASS = "ã“ã¾ã˜ã‚ã†"; 

        // ==========================================
        //  ãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬ä½“
        // ==========================================

        // 1. åˆè¨€è‘‰ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
        (function checkPassword() {
            const input = prompt("ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è­·ã®ãŸã‚ã€åˆè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            if (input === SECRET_PASS) {
                document.getElementById('mainCard').style.display = 'block';
            } else {
                document.body.innerHTML = "<h2 class='error-msg'>ğŸš« åˆè¨€è‘‰ãŒé•ã„ã¾ã™ã€‚<br>ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚</h2>";
            }
        })();

        // 2. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®é …ç›®å®šç¾©
        const sections = [
            { 
                title: "ãƒ›ãƒ¼ãƒ«", 
                items: [
                    "ç®¸é†¤æ²¹ã€ãƒãƒ¨è£œå……ã—ãŸã‹",
                    "ç”Ÿå§œé–‰ã¾ã£ãŸã‹",
                    "ãƒ›ãƒ¼ãƒ«åºŠã‚´ãƒŸè½ã¡ã¦ãªã„ã‹",
                    "åˆ¸å£²æ©Ÿã€å£²ä¸Šé€Ÿå ±ã€éµé–‰ã‚",
                    "èƒŒè„‚ä¿æ¸©ã‚¹ã‚¤ãƒƒãƒå…¥ã£ã¦ã„ã‚‹ã‹",
                    "åµè£œå……ã€ãŠã¾ã‘ã‚¿ãƒƒãƒ‘ãƒ¼è£œå……",
                    "ã‚´ãƒŸç‰‡ä»˜ã‘ã€ãƒˆã‚¤ãƒ¬é›»æ°—",
                    "ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨æ‹­ã"
                ]
            },
            { 
                title: "æ´—ã„å ´", 
                items: [
                    "ãƒãƒ³ãƒ‰ã‚½ãƒ¼ãƒ—ã€æ´—å‰¤è£œå……",
                    "æ´—ã„å ´ã‚´ãƒŸè½ã¡ã¦ãªã„ã‹"
                ]
            },
            { 
                title: "ä¸€ç•ªæ‰‹", 
                items: [
                    "ã‚¬ã‚¹å…ƒæ “é–‰ã¾ã£ã¦ã„ã‚‹ã‹",
                    "ã‚³ãƒ¼ãƒ«ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ç¶ºéº—ã‹",
                    "ã‚¹ãƒ¼ãƒ—ã€å‰ç„¼ã€é‡èœã—ã¾ã£ãŸã‹",
                    "è£œå……ç³»çµ‚ã‚ã£ã¦ã„ã‚‹ã‹",
                    "æ°´é“é–‰ã¾ã£ã¦ã„ã‚‹ã‹",
                    "éºµæ®‹é‡æ›¸ã„ãŸã‹"
                ]
            }
        ];

        // 3. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹å‡¦ç†
        const listDiv = document.getElementById('checklist');
        sections.forEach(sec => {
            listDiv.innerHTML += `<h2>${sec.title}</h2>`;
            sec.items.forEach((item, idx) => {
                const id = `${sec.title}-${idx}`; // IDã‚’ä¸€æ„ã«ã™ã‚‹
                listDiv.innerHTML += `
                    <label class="item" for="${id}">
                        <input type="checkbox" id="${id}">
                        ${item}
                    </label>
                `;
            });
        });

        // 4. ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹æ©Ÿèƒ½ (ReferenceErrorå¯¾ç­–æ¸ˆ)
        async function submitData() {
            const userName = document.getElementById('userName').value;
            if (!userName) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

            // GASã®URLãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã®ãƒã‚§ãƒƒã‚¯
            if (GAS_URL.includes("â˜…")) return alert("ã‚¨ãƒ©ãƒ¼ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®GAS_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼");

            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const total = checkboxes.length;
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            // å…¨ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹åˆ¤å®š
            const allChecked = (total === checkedCount);
            const status = allChecked ? "âœ…å®Œäº†" : "âš ï¸æœªå®Œäº†ã‚ã‚Š";

            if (!confirm(`ã€æ‹…å½“ï¼š${userName}ã€‘\nã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š${status}\n\nã“ã®å†…å®¹ã§é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ`)) return;

            const data = { user: userName, status: status };

            try {
                // é€ä¿¡å‡¦ç†
                await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify(data)
                });
                alert("é€ä¿¡æˆåŠŸï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚");
                location.reload(); // é€ä¿¡å¾Œã«ç”»é¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            } catch (e) {
                console.error(e);
                alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nURLãŒæ­£ã—ã„ã‹ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            }
        }

        // 5. å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€æ©Ÿèƒ½
        async function fetchHistory() {
            const historyDiv = document.getElementById('history');
            
            // GASã®URLãƒã‚§ãƒƒã‚¯
            if (GAS_URL.includes("â˜…")) return alert("ã‚¨ãƒ©ãƒ¼ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®GAS_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼");

            historyDiv.innerHTML = "ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...";
            
            try {
                const response = await fetch(GAS_URL);
                const data = await response.json();
                
                historyDiv.innerHTML = "<h3>ğŸ“… æœ€è¿‘ã®è¨˜éŒ²ï¼ˆæœ€æ–°5ä»¶ï¼‰</h3>";
                
                // æ–°ã—ã„é †ï¼ˆé€†é †ï¼‰ã«ã—ã¦ã€ä¸Šã‹ã‚‰5ã¤ã ã‘è¡¨ç¤º
                data.reverse().slice(0, 5).forEach(row => {
                    // row[0]=æ—¥ä»˜, row[1]=åå‰, row[2]=çŠ¶æ…‹
                    const dateObj = new Date(row[0]);
                    const dateStr = dateObj.toLocaleDateString() + " " + dateObj.getHours() + ":" + String(dateObj.getMinutes()).padStart(2, '0');
                    
                    historyDiv.innerHTML += `
                        <div class="history-item">
                            <div><b>${dateStr}</b> - ${row[1]}</div>
                            <div style="color:${row[2].includes('å®Œäº†') ? 'green' : 'red'}">${row[2]}</div>
                        </div>
                    `;
                });
            } catch (e) {
                console.error(e);
                historyDiv.innerHTML = "<p style='color:red'>å±¥æ­´ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>";
            }
        }
    </script>
</body>
</html>